---
title: "Paoer1"
subtitle: "TBD"
author: "TBD"
thanks: "Code and data are available at: LINK."
date: "`r format(Sys.time(), '%d %B %Y')`"
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
output:
  bookdown::pdf_document2:
    latex_engine: xelatex
toc: FALSE
bibliography: references.bib
---

```{r setup, include=FALSE}
library(knitr)
opts_chunk$set(echo=FALSE,
               cache=TRUE, autodep=TRUE, cache.comments=FALSE,
               message=FALSE, warning=FALSE)

# Load in the packages 
library(tidyverse)
library(palmerpenguins)
library(here)
library(janitor)
library(kableExtra)

# Get the code from R script and load in the data
all_data_path <- 
  here::here('inputs/data/raw_data.csv')

```

```{r, include=FALSE}

all_data <- read_csv(all_data_path)

# Change the variable names. This is to make them easier to type and less confusing.
commDiseases <- 
  all_data %>%
  janitor::clean_names()%>%
  select(disease:x85) %>%
  mutate(
         y0_19 = x1_2 + x01_04 + x05_09 + x10_14 + x15_19,
         y20_39 = x20_24+ x25_29 + x30_34 + x35_39, 
         y40_59 = x40_44+ x45_49 + x50_54 + x55_59,
         y60_79 = x60_64+ x65_69 + x70_74 + x75_79,
         y80 = x80_84 + x85) %>%
  mutate(total=y0_19+y20_39+y40_59+y60_79+y80)%>%
  select (disease,sex,y0_19,y20_39,y40_59,y60_79,y80,total)

# Clean the data: there are three rows in the bottom with text explanations of the data. Need to delete the rows. 
ByDisease <- filter(commDiseases, !is.na(sex))%>%
  group_by(disease)%>%
  summarise(
    totalDisease= sum(total, na.rm = TRUE)
    ) %>% 
  arrange(desc(totalDisease)) %>%
  top_n(3) # Top 3 disease by the number of people infected are Chlamydia,Gonorrhea,Influenza. 

# Get the names for the top three disease by total number. 
top_3_disase <- ByDisease$disease 

# Build a new data table with only the top three disease by total number for further analysis. 
FinalDisease <- commDiseases %>%
  filter(disease %in% c(top_3_disase))

```

# Introduction

# Data

Our data is of penguins (Figure \@ref(fig:bills)) and we analyzed using R [@citeR] and the 'ggplot2' package[@cy1]. We build on [@diagnostics10040243] and [@covid2020post] to analyze the data.

```{r Table1, fig.cap="Disease Case Count by Age Group in 2018.",echo = FALSE}

# Build a table that shows the number of people infect by disease by age groups. And made the table look nice. 
FinalDisease %>%
  select(!sex) %>%
  group_by(disease)%>%
  summarise_each(list(sum)) %>%
  rename('Age 0-19' = y0_19, 'Age 20-39' = y20_39,'Age 40-59' = y40_59,'Age 60-79' = y60_79, 'Age 80+' = y80, 'Total' = total, 'Disease' = disease) %>% 
  kableExtra::kbl(caption = "Disease Case Count by Age Group in 2018") %>%
  kableExtra::kable_styling()
```




```{r Table2, fig.cap="Disease Case Count by Sex in 2018.", echo=FALSE}

FinalDisease %>% 
  select(disease, sex, total) %>% 
  pivot_wider(
    names_from = sex,
    values_from = total) %>% 
 rename("Disease" = disease )%>% 
  kableExtra::kbl(caption = "Disease Case Count by Sex in 2018") %>%
  kableExtra::kable_styling()
```



```{r fig01, fig.cap="Diseases Case Counts by Sex in 2018", echo = FALSE, fig.width=8, fig.height=4}
FinalDisease %>%
  select(disease, sex, total)%>%
  ggplot() + 
  geom_bar(mapping = aes(x = disease, fill = sex, y=total), 
           stat = "identity",
           alpha = 4/5)+
    labs(
         x = "Diseases",
       y = "Diseases Case Count", 
       fill="Sex", caption = "Source: Open Data – City of Toronto"
      )


```


```{r fig02, fig.cap="Diseases Case Counts by Age Groups in 2018", echo = FALSE, fig.width=8, fig.height=4}
# Build pivot table to move the age groups variable to values of a "AgeGroup" variable. 
FinalDisease %>%
  select(!total) %>%
  pivot_longer(
    cols = y0_19 : y80,
    names_to = "AgeGroup",
    values_to = "total"
    ) %>%
  ggplot()+
  geom_bar(mapping = aes(x = disease,  fill = AgeGroup, y=total),
           stat = "identity", alpha = 4/5, position = "fill" 
           ) +
  labs( 
       x = "Diseases",
       y = "Case Count (%)",
       caption = "Source: Open Data – City of Toronto") +
  scale_fill_manual(values=c("#999999", "#E69F00", "#706249","#e9dd56", "#e98756"), 
                       name="Age Groups",
                       breaks=c("y0_19", "y20_39", "y40_59", "y60_79", "y80"),
                       labels=c("Age 0-19", "Age 20-39",'Age 40-59','Age 60-79','Age 80+'))

```



```{r fig03, fig.cap="Age and Sex Distributions of Diseases Case Counts in 2018", echo = FALSE, fig.width=8, fig.height=4}
# Build pivot table to move the age groups variable to values of a "AgeGroup" variable. 
FinalDisease %>%
  select(!total) %>%
  rename('Age 0-19' = y0_19, 'Age 20-39' = y20_39,'Age 40-59' = y40_59,'Age 60-79' = y60_79, 'Age 80+' = y80, 'Disease' = disease) %>% 
  pivot_longer(
    cols = 'Age 0-19' : 'Age 80+',
    names_to = "AgeGroup",
    values_to = "total"
  ) %>%
  # Build the bar chart for age group distribution of the top three diseases. 
  ggplot()+
facet_wrap(~Disease )+
  geom_bar(aes(AgeGroup,total, fill=sex), stat = "identity", position = "dodge") +
  coord_flip()+
      labs(
         x = "Age Groups",
       y = "Diseases Case Count", fill="Sex",
       caption = "Source: Open Data – City of Toronto"
      )

```



Talk way more about it.



# Results

# Discussion

## First discussion point

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this.

## Second discussion point

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

# Appendix {.unnumbered}

\newpage

# References
